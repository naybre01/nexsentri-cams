mqtt:
  # Use the service name defined in docker-compose.yml
  host: mqtt
  port: 1883

ffmpeg:
  # Use Raspberry Pi 4 hardware acceleration preset
  hwaccel_args: preset-rpi-64-h264

detectors:
  cpu1:
    type: cpu
    num_threads: 3

# WebRTC Streaming Configuration
# Go2RTC connects to the hardware device (/dev/video0)
# It then serves this stream to Frigate and WebRTC clients
go2rtc:
  webrtc:
    listen: :8555
    # IMPORTANT: Update the IP below to your Raspberry Pi's actual LAN IP
    candidates:
      - 192.168.1.170:8555 
      - stun:8555
  api:
    trusted_proxies: [172.16.0.0/12, 192.168.0.0/24, 10.0.0.0/8]
  streams:
    front_cam:
      - /dev/video0

cameras:
  front_cam:
    ffmpeg:
      input_args:
        - -input_format
        - mjpeg
        - -pix_fmt
        - yuvj422p
      
      # FIX: Transcode MJPEG to H.264 using Pi hardware encoder (h264_v4l2m2m)
      # This resolves the "Could not find tag for codec rawvideo" error.
      output_args:
        record: -f segment -segment_time 10 -segment_format mp4 -reset_timestamps 1 -strftime 1 -c:v h264_v4l2m2m -b:v 4M -an

      inputs:
        # CRITICAL FIX: Read from Go2RTC stream (localhost) instead of hardware device
        # This allows Go2RTC to own the hardware, while Frigate consumes the stream for detect/record.
        - path: rtsp://127.0.0.1:8554/front_cam
          roles:
            - record
            - detect
    
    detect:
      width: 1280
      height: 720
      fps: 5
    objects:
      track:
        - person
        - car
        - bus
        - motorcycle
        - bicycle

    # MJPEG stream for the Dashboard
    live:
      height: 720
      quality: 8

record:
  enabled: true
  retain:
    days: 1
    mode: motion

snapshots:
  enabled: true
  clean_copy: true
  timestamp: true
  bounding_box: true
  crop: true
  height: 720
  retain:
    default: 5
    objects:
      person: 7

semantic_search:
  enabled: true
  model_size: small

detect:
  enabled: true
  fps: 5
  width: 1280
  height: 720

ui:
  time_format: 24hour

# Note: Face Recognition and LPR are features of Frigate 0.16+ (beta).
# If you are on the 'stable' tag (0.14/0.15), these keys might cause startup errors.
# Uncomment them only if you are using the correct Frigate version.
# face_recognition:
#   enabled: true
#   model_size: small

# lpr:
#   enabled: true
