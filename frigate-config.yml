mqtt:
  # Use the service name defined in docker-compose.yml
  host: mqtt
  port: 1883


detectors:
  cpu1:
    type: cpu
    num_threads: 3

cameras:
  front_cam:
    ffmpeg:
      # These input arguments are optimized for UVC cameras like the JVCU100
      # that support native MJPEG output. This reduces CPU load on the Pi.
      input_args:
        - -input_format
        - mjpeg
        - -pix_fmt
        - yuvj422p
      
      # FIX: The camera outputs MJPEG, but Frigate needs H.264 for recording.
      # By default, Frigate tries to 'copy' the stream, which fails for MJPEG -> MP4.
      # We must enable the hardware encoder (h264_v4l2m2m) on the Pi 4.
      output_args:
        record: -f segment -segment_time 10 -segment_format mp4 -reset_timestamps 1 -strftime 1 -c:v h264_v4l2m2m -b:v 4M -an

      inputs:
        - path: /dev/video0
          roles:
            - detect
            - record
    detect:
      width: 1280
      height: 720
      fps: 5 # Kept low for RPi4 CPU usage. Increase if you add a Coral TPU.
    objects:
      track:
        - person
        - car
        - bus
        - motorcycle
        - bicycle
    snapshots:
      enabled: True
    record:
      enabled: True
      retain:
        days: 1
        mode: motion
    # MJPEG stream for the Dashboard
    live:
      height: 720
      quality: 8